

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>transfer_baltrad &mdash; vptstools 0.4.0.post1.dev1+g2841941 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=ffb6f3fa"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            vptstools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Module Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">vptstools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">transfer_baltrad</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/click.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="transfer-baltrad">
<h1>transfer_baltrad<a class="headerlink" href="#transfer-baltrad" title="Link to this heading"></a></h1>
<p>Sync files from Baltrad FTP server to the Aloft S3 bucket.</p>
<p>This function connects via SFTP to the BALTRAD server, downloads the available VP files (PVOL gets ignored),
from the FTP server and upload the HDF5 file to the Aloft S3 bucket according to the defined folder path name
convention. Existing files are ignored.</p>
<p>Designed to be executed via a simple scheduled job like cron or scheduled cloud function. Remark that
files disappear after a few days on the BALTRAD server.</p>
<p>Configuration is loaded from the following environmental variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FTP_HOST</span></code>: Baltrad FTP host ip address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FTP_PORT</span></code>: Baltrad FTP host port</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FTP_USERNAME</span></code>: Baltrad FTP user name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FTP_PWD</span></code>: Baltrad FTP password</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FTP_DATADIR</span></code>: Baltrad FTP directory to load data files from</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DESTINATION_BUCKET</span></code>: AWS S3 bucket to write data to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SNS_TOPIC</span></code>: AWS SNS topic to report when routine fails</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_REGION</span></code>: AWS region where the SNS alerting is defined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_PROFILE</span></code>: AWS profile (mainly useful for local development when working with multiple AWS profiles)</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>transfer_baltrad<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="vph5-to-vpts">
<h1>vph5_to_vpts<a class="headerlink" href="#vph5-to-vpts" title="Link to this heading"></a></h1>
<p>Convert and aggregate HDF5 VP files to daily and monthly VPTS CSV files on S3 bucket</p>
<p>Check the latest modified
<a class="reference external" href="https://github.com/adokter/vol2bird/wiki/ODIM-bird-profile-format-specification">ODIM HDF5 bird VP profile</a>  on the
Aloft S3 bucket (as generated by <a class="reference external" href="https://github.com/adokter/vol2bird">vol2bird</a> and transferred using the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">vpts.bin.transfer_baltrad</span></code> CLI routine). Using an
<a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-inventory.html">s3 inventory bucket</a>, check which
HDF5 files were recently added and convert those files from ODIM bird profile to the
<a class="reference external" href="https://github.com/aloftdata/vpts-csv">VPTS CSV format</a>. Finally, upload the generated daily/monthly VPTS files to S3.</p>
<p>When using the <cite>path_s3_folder</cite> option, the modified date is not used, but a recursive search within the given s3
path is applied to define the daily/monthly files to recreate.
E.g. <cite>vph5_to_vpts –path-s3-folder uva/hdf5/nldhl/2019</cite> or
<cite>vph5_to_vpts –path-s3-folder baltrad/hdf5/bejab/2022/10</cite>.</p>
<p>Besides, while scanning the S3 inventory to define the files to convert,
the CLI routine creates the <code class="docutils literal notranslate"><span class="pre">coverage.csv</span></code> file and uploads it to the bucket.</p>
<p>Configuration is loaded from the following environmental variables:</p>
<div class="line-block">
<div class="line">- <code class="docutils literal notranslate"><span class="pre">DESTINATION_BUCKET</span></code>: AWS S3 bucket to read and write data to</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">INVENTORY_BUCKET</span></code>: AWS S3 bucket configured as <a href="#id1"><span class="problematic" id="id2">`</span></a>s3 inventory bucket</div>
<div class="line-block">
<div class="line">&lt;<a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-inventory.html">https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-inventory.html</a>&gt;`_</div>
<div class="line">for the S3_BUCKET.</div>
</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">SNS_TOPIC</span></code>: AWS SNS topic to report when routine fails</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">AWS_REGION</span></code>: AWS region where the SNS alerting is defined</div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">AWS_PROFILE</span></code>: AWS profile (mainly useful for local development when</div>
<div class="line-block">
<div class="line">working with multiple AWS profiles)</div>
</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vph5_to_vpts<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-vph5_to_vpts-modified-days-ago">
<span class="sig-name descname"><span class="pre">--modified-days-ago</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;modified_days_ago&gt;</span></span><a class="headerlink" href="#cmdoption-vph5_to_vpts-modified-days-ago" title="Link to this definition"></a></dt>
<dd><p>Range of HDF5 VP files to include, i.e. files modified between now and Nmodified-days-ago. If 0, all HDF5 files in the bucket will be included.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-vph5_to_vpts-path-s3-folder">
<span class="sig-name descname"><span class="pre">--path-s3-folder</span></span><span class="sig-prename descclassname"> <span class="pre">&lt;path_s3_folder&gt;</span></span><a class="headerlink" href="#cmdoption-vph5_to_vpts-path-s3-folder" title="Link to this definition"></a></dt>
<dd><p>Apply the conversion to VPTS to all files within a S3 sub-folders instead of using the modified date of the files. This option does not use the inventory files.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Research Institute for Nature and Forest (INBO).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>